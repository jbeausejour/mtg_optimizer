<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Optimizer</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const MainPage = () => {
          const [cardList, setCardList] = useState('');
          
          useEffect(() => {
            fetchCardList();
          }, []);
          
          const fetchCardList = async () => {
            const response = await fetch('/get_card_list');
            const data = await response.text();
            setCardList(data);
          };

          const handleClearList = () => {
            setCardList('');
          };

          const handleSearch = () => {
            console.log('Search initiated with card list:', cardList);
            // Implement your search logic here
          };

          return (
            <div>
              <h1>Welcome to MTG Optimizer</h1>
              <textarea
                rows="10"
                cols="50"
                value={cardList}
                onChange={(e) => setCardList(e.target.value)}
                placeholder="Enter your card list here..."
              />
              <br />
              <button onClick={handleClearList}>Clear List</button>
              <button onClick={handleSearch}>Search</button>
            </div>
          );
        };

        const SiteForm = ({ onAdd }) => {
          const [site, setSite] = useState({ name: '', url: '', parse_method: '', type: '' });

          const handleSubmit = async (e) => {
            e.preventDefault();
            onAdd(site);
            setSite({ name: '', url: '', parse_method: '', type: '' });
          };

          return (
            <div>
              <h2>Add New Site</h2>
              <form onSubmit={handleSubmit}>
                <input
                  type="text"
                  placeholder="Name"
                  value={site.name}
                  onChange={(e) => setSite({ ...site, name: e.target.value })}
                  required
                />
                <input
                  type="text"
                  placeholder="URL"
                  value={site.url}
                  onChange={(e) => setSite({ ...site, url: e.target.value })}
                  required
                />
                <input
                  type="text"
                  placeholder="Parse Method"
                  value={site.parse_method}
                  onChange={(e) => setSite({ ...site, parse_method: e.target.value })}
                  required
                />
                <input
                  type="text"
                  placeholder="Type"
                  value={site.type}
                  onChange={(e) => setSite({ ...site, type: e.target.value })}
                  required
                />
                <button type="submit">Add Site</button>
              </form>
            </div>
          );
        };

        const SiteList = ({ sites, onDelete, onUpdate }) => {
          const [editSiteId, setEditSiteId] = useState(null);
          const [editFormData, setEditFormData] = useState({
            name: '',
            url: '',
            parse_method: '',
            type: ''
          });

          const handleEditClick = (site) => {
            setEditSiteId(site.id);
            setEditFormData(site);
          };

          const handleEditChange = (e) => {
            const { name, value } = e.target;
            setEditFormData({ ...editFormData, [name]: value });
          };

          const handleEditSubmit = async (e) => {
            e.preventDefault();
            onUpdate(editFormData);
            setEditSiteId(null);
          };

          const handleCancelClick = () => {
            setEditSiteId(null);
          };

          return (
            <div>
              <h2>Site List</h2>
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>URL</th>
                    <th>Parse Method</th>
                    <th>Type</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {sites.map((site) => (
                    editSiteId === site.id ? (
                      <tr key={site.id}>
                        <td><input type="text" name="name" value={editFormData.name} onChange={handleEditChange} /></td>
                        <td><input type="text" name="url" value={editFormData.url} onChange={handleEditChange} /></td>
                        <td><input type="text" name="parse_method" value={editFormData.parse_method} onChange={handleEditChange} /></td>
                        <td><input type="text" name="type" value={editFormData.type} onChange={handleEditChange} /></td>
                        <td>
                          <button onClick={handleEditSubmit}>Confirm</button>
                          <button onClick={handleCancelClick}>Cancel</button>
                        </td>
                      </tr>
                    ) : (
                      <tr key={site.id}>
                        <td>{site.name}</td>
                        <td>{site.url}</td>
                        <td>{site.parse_method}</td>
                        <td>{site.type}</td>
                        <td>
                          <button onClick={() => handleEditClick(site)}>Edit</button>
                          <button onClick={() => onDelete(site.id)}>Delete</button>
                        </td>
                      </tr>
                    )
                  ))}
                </tbody>
              </table>
            </div>
          );
        };

        const SiteManagement = () => {
          const [sites, setSites] = useState([]);

          useEffect(() => {
            fetchSiteList();
          }, []);

          const fetchSiteList = async () => {
            const response = await fetch('/get_site_list');
            const data = await response.json();
            setSites(data);
          };

          const handleAddSite = async (newSite) => {
            const response = await fetch('/add_site', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(newSite)
            });
            if (response.ok) {
              fetchSiteList();
            }
          };

          const handleUpdateSite = async (updatedSite) => {
            const response = await fetch(`/update_site/${updatedSite.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(updatedSite)
            });
            if (response.ok) {
              fetchSiteList();
            }
          };

          const handleDeleteSite = async (id) => {
            const response = await fetch(`/delete_site/${id}`, {
              method: 'DELETE'
            });
            if (response.ok) {
              fetchSiteList();
            }
          };

          return (
            <div>
              <h1>Site Management</h1>
              <SiteForm onAdd={handleAddSite} />
              <SiteList sites={sites} onDelete={handleDeleteSite} onUpdate={handleUpdateSite} />
            </div>
          );
        };

        const App = () => {
          const [currentPage, setCurrentPage] = useState('main');

          const renderPage = () => {
            switch (currentPage) {
              case 'main':
                return <MainPage />;
              case 'manage-sites':
                return <SiteManagement />;
              default:
                return <MainPage />;
            }
          };

          return (
            <div>
              <nav>
                <ul>
                  <li>
                    <button onClick={() => setCurrentPage('main')}>Home</button>
                  </li>
                  <li>
                    <button onClick={() => setCurrentPage('manage-sites')}>Manage Sites</button>
                  </li>
                </ul>
              </nav>
              {renderPage()}
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
